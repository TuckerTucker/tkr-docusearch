<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Research - DocuSearch</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="/frontend" class="back-button">‚Üê Back to Library</a>
            <h1 id="page-title">Research</h1>
        </div>
    </header>

    <!-- Query Input -->
    <section class="query-section">
        <form id="research-form" class="query-form">
            <div class="input-group">
                <input
                    type="text"
                    id="query-input"
                    class="query-input"
                    placeholder="Ask a question about your documents..."
                    aria-label="Research question"
                    required
                    minlength="3"
                    maxlength="500"
                />
                <button type="submit" class="ask-button" aria-label="Submit question">
                    Ask
                </button>
            </div>
        </form>
    </section>

    <!-- Main Content (Two-Panel Layout) -->
    <main class="research-main">
        <!-- Left Panel: Answer -->
        <section class="answer-panel" aria-label="Answer">
            <div id="answer-container" class="answer-container">
                <!-- Empty state -->
                <div id="empty-state" class="empty-state">
                    <h2>Start your research</h2>
                    <p>Ask a question about your documents to get AI-generated answers with citations.</p>
                    <p style="margin-top: var(--space-4); font-size: var(--font-size-sm);">
                        Example: "What are the benefits of renewable energy?"
                    </p>
                </div>

                <!-- Loading state -->
                <div id="loading-state" class="loading-state hidden">
                    <div class="loading-spinner"></div>
                    <p>Researching your question...</p>
                </div>

                <!-- Answer display (populated by answer-display.js) -->
                <div id="answer-display" class="answer-display hidden">
                    <!-- Dynamic content -->
                </div>

                <!-- Error state -->
                <div id="error-state" class="error-state hidden">
                    <p class="error-message" id="error-message"></p>
                    <button id="retry-button" class="retry-button">Try Again</button>
                </div>
            </div>
        </section>

        <!-- Right Panel: References -->
        <aside class="references-panel" aria-label="References">
            <div class="references-header">
                <h2>References</h2>
                <div class="view-toggle-group" role="group" aria-label="View mode">
                    <button
                        id="detailed-view-btn"
                        class="view-toggle active"
                        data-view="detailed"
                        aria-pressed="true"
                    >
                        Detailed
                    </button>
                    <button
                        id="simple-view-btn"
                        class="view-toggle"
                        data-view="simple"
                        aria-pressed="false"
                    >
                        Simple
                    </button>
                </div>
            </div>

            <div id="references-container" class="references-container">
                <!-- Empty state -->
                <div id="references-empty" class="references-empty empty-state">
                    <p>References will appear here after submitting a query.</p>
                </div>

                <!-- Reference cards (populated by reference-card.js) -->
                <div id="references-list" class="references-list hidden">
                    <!-- Dynamic content -->
                </div>
            </div>
        </aside>
    </main>

    <!-- Footer -->
    <footer class="footer" role="contentinfo">
        <div class="footer__container">
            <div class="footer__actions">
                <!-- Style Selector -->
                <div class="style-selector">
                    <button
                        id="style-selector-button"
                        class="style-selector__button"
                        aria-label="Select visual style"
                        aria-expanded="false"
                        aria-haspopup="true"
                        title="Choose visual style">
                        <svg class="style-selector__icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path>
                        </svg>
                    </button>
                    <div id="style-selector-dropdown" class="style-selector__dropdown" role="menu" aria-labelledby="style-selector-button">
                        <ul class="style-selector__list">
                            <!-- Options will be dynamically inserted here -->
                        </ul>
                    </div>
                </div>

                <!-- Theme Toggle (Light/Dark) -->
                <button
                    id="theme-toggle-footer"
                    class="theme-toggle"
                    aria-label="Toggle theme"
                    title="Toggle light/dark theme">
                    <svg class="theme-toggle__icon theme-toggle__icon--sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <svg class="theme-toggle__icon theme-toggle__icon--moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
            </div>

            <div class="footer__status" style="display: none;">
                <span id="connection-status" class="connection-status connection-status--disconnected" role="status" aria-live="polite">
                    Disconnected
                </span>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script type="module" src="theme-toggle.js"></script>
    <script type="module" src="style-selector.js"></script>
    <script type="module" src="assets.js"></script>
    <script type="module" src="answer-display.js"></script>
    <script type="module" src="reference-card.js"></script>
    <script type="module" src="research-controller.js"></script>
</body>
</html>
