<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Research - DocuSearch</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Research Page Specific Styles */
        .research-page {
            min-height: 100vh;
            background: var(--color-bg-secondary);
        }

        .research-header {
            position: sticky;
            top: 0;
            z-index: var(--z-sticky);
            background: var(--color-bg-primary);
            border-bottom: 1px solid var(--color-border);
            padding: var(--space-4) var(--space-6);
        }

        .header-content {
            max-width: var(--max-width, 1440px);
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .research-header h1 {
            font-size: var(--font-size-2xl, 2rem);
            color: var(--color-text-primary);
            margin: 0;
        }

        .header-actions {
            display: flex;
            gap: var(--space-3);
            align-items: center;
        }

        /* Query Section */
        .query-section {
            padding: var(--space-6);
            background: var(--color-bg-primary);
            border-bottom: 1px solid var(--color-border);
        }

        .query-form {
            max-width: 800px;
            margin: 0 auto;
        }

        .input-group {
            display: flex;
            gap: var(--space-3);
        }

        .query-input {
            flex: 1;
            padding: var(--space-3) var(--space-4);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md, 0.5rem);
            font-size: var(--font-size-base, 1rem);
            font-family: var(--font-sans);
            background: var(--color-bg-primary);
            color: var(--color-text-primary);
        }

        .query-input:focus {
            outline: 2px solid var(--color-primary-base);
            outline-offset: 2px;
        }

        .ask-button {
            padding: var(--space-3) var(--space-6);
            background: var(--color-primary-base);
            color: var(--color-bg-primary);
            border: none;
            border-radius: var(--radius-md, 0.5rem);
            font-size: var(--font-size-base, 1rem);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--trans-fast, 150ms);
        }

        .ask-button:hover {
            background: var(--color-primary-hover);
        }

        .ask-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Main Content */
        .research-main {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-6);
            padding: var(--space-6);
            max-width: var(--max-width, 1440px);
            margin: 0 auto;
            min-height: calc(100vh - 200px);
        }

        /* Answer Panel */
        .answer-panel {
            background: var(--color-bg-primary);
            border-radius: var(--radius-lg, 0.75rem);
            padding: var(--space-6);
            box-shadow: var(--shadow-md);
        }

        .answer-container {
            min-height: 300px;
        }

        /* References Panel */
        .references-panel {
            background: var(--color-bg-primary);
            border-radius: var(--radius-lg, 0.75rem);
            padding: var(--space-6);
            box-shadow: var(--shadow-md);
        }

        .references-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
        }

        .references-header h2 {
            font-size: var(--font-size-xl, 1.5rem);
            color: var(--color-text-primary);
            margin: 0;
        }

        .view-toggle-group {
            display: flex;
            gap: var(--space-2);
        }

        .view-toggle {
            padding: var(--space-2) var(--space-4);
            border: 1px solid var(--color-border);
            background: transparent;
            border-radius: var(--radius-md, 0.5rem);
            cursor: pointer;
            transition: all var(--trans-base, 200ms);
            font-size: var(--font-size-sm, 0.875rem);
            color: var(--color-text-secondary);
        }

        .view-toggle.active {
            background: var(--color-primary-base);
            color: var(--color-bg-primary);
            border-color: var(--color-primary-base);
        }

        /* States */
        .empty-state {
            text-align: center;
            padding: var(--space-8) var(--space-4);
            color: var(--color-text-secondary);
        }

        .empty-state h2 {
            font-size: var(--font-size-xl, 1.5rem);
            margin-bottom: var(--space-2);
        }

        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--space-8) var(--space-4);
            gap: var(--space-4);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--color-border);
            border-top-color: var(--color-primary-base);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-state {
            text-align: center;
            padding: var(--space-8) var(--space-4);
        }

        .error-message {
            color: var(--color-status-error);
            margin-bottom: var(--space-4);
        }

        .retry-button {
            padding: var(--space-2) var(--space-4);
            background: var(--color-primary-base);
            color: var(--color-bg-primary);
            border: none;
            border-radius: var(--radius-md, 0.5rem);
            cursor: pointer;
        }

        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .research-main {
                grid-template-columns: 1fr;
            }

            .input-group {
                flex-direction: column;
            }

            .ask-button {
                width: 100%;
            }
        }
    </style>
</head>
<body class="kraft-theme research-page">
    <!-- Header -->
    <header class="research-header">
        <div class="header-content">
            <h1>Research</h1>
            <div class="header-actions">
                <a href="/" class="back-link">‚Üê Back to Documents</a>
                <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"/>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Query Input -->
    <section class="query-section">
        <form id="research-form" class="query-form">
            <div class="input-group">
                <input
                    type="text"
                    id="query-input"
                    class="query-input"
                    placeholder="Ask a question about your documents..."
                    aria-label="Research question"
                    required
                    minlength="3"
                    maxlength="500"
                />
                <button type="submit" class="ask-button" aria-label="Submit question">
                    Ask
                </button>
            </div>
        </form>
    </section>

    <!-- Main Content (Two-Panel Layout) -->
    <main class="research-main">
        <!-- Left Panel: Answer -->
        <section class="answer-panel" aria-label="Answer">
            <div id="answer-container" class="answer-container">
                <!-- Empty state -->
                <div id="empty-state" class="empty-state">
                    <h2>Start your research</h2>
                    <p>Ask a question about your documents to get AI-generated answers with citations.</p>
                    <p style="margin-top: var(--space-4); font-size: var(--font-size-sm);">
                        Example: "What are the benefits of renewable energy?"
                    </p>
                </div>

                <!-- Loading state -->
                <div id="loading-state" class="loading-state hidden">
                    <div class="loading-spinner"></div>
                    <p>Researching your question...</p>
                </div>

                <!-- Answer display (populated by answer-display.js) -->
                <div id="answer-display" class="answer-display hidden">
                    <!-- Dynamic content -->
                </div>

                <!-- Error state -->
                <div id="error-state" class="error-state hidden">
                    <p class="error-message" id="error-message"></p>
                    <button id="retry-button" class="retry-button">Try Again</button>
                </div>
            </div>
        </section>

        <!-- Right Panel: References -->
        <aside class="references-panel" aria-label="References">
            <div class="references-header">
                <h2>References</h2>
                <div class="view-toggle-group" role="group" aria-label="View mode">
                    <button
                        id="detailed-view-btn"
                        class="view-toggle active"
                        data-view="detailed"
                        aria-pressed="true"
                    >
                        Detailed
                    </button>
                    <button
                        id="simple-view-btn"
                        class="view-toggle"
                        data-view="simple"
                        aria-pressed="false"
                    >
                        Simple
                    </button>
                </div>
            </div>

            <div id="references-container" class="references-container">
                <!-- Empty state -->
                <div id="references-empty" class="references-empty empty-state">
                    <p>References will appear here after submitting a query.</p>
                </div>

                <!-- Reference cards (populated by reference-card.js) -->
                <div id="references-list" class="references-list hidden">
                    <!-- Dynamic content -->
                </div>
            </div>
        </aside>
    </main>

    <!-- Scripts -->
    <script type="module" src="assets.js"></script>
    <script type="module" src="answer-display.js"></script>
    <script type="module" src="reference-card.js"></script>
    <script type="module" src="research-controller.js"></script>
</body>
</html>
