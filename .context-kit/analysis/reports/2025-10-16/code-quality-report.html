<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Quality Analysis Report - tkr-docusearch</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 2rem;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3rem 2rem;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }
        
        .header .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .header .meta {
            margin-top: 1rem;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .content {
            padding: 2rem;
        }
        
        .section {
            margin-bottom: 3rem;
        }
        
        .section h2 {
            color: #667eea;
            font-size: 1.8rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid #667eea;
        }
        
        .section h3 {
            color: #764ba2;
            font-size: 1.3rem;
            margin: 1.5rem 0 0.75rem 0;
        }
        
        .executive-summary {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        
        .score-card {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }
        
        .score-item {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .score-item .label {
            font-size: 0.9rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }
        
        .score-item .value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 0.5rem 0;
        }
        
        .score-item .description {
            font-size: 0.85rem;
            color: #777;
        }
        
        .score-excellent { color: #22c55e; }
        .score-good { color: #84cc16; }
        .score-moderate { color: #eab308; }
        .score-poor { color: #f97316; }
        .score-critical { color: #ef4444; }
        
        .severity-critical { background: #fef2f2; border-left: 4px solid #ef4444; }
        .severity-major { background: #fefce8; border-left: 4px solid #eab308; }
        .severity-minor { background: #f0f9ff; border-left: 4px solid #3b82f6; }
        
        .finding {
            margin: 1rem 0;
            padding: 1rem;
            border-radius: 6px;
        }
        
        .finding-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .finding-title {
            font-weight: bold;
            font-size: 1.05rem;
        }
        
        .finding-location {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.85rem;
            color: #666;
            background: #f4f4f4;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }
        
        .finding-details {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: #555;
        }
        
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            margin: 0.5rem 0;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.85rem;
            line-height: 1.4;
        }
        
        .line-number {
            color: #858585;
            margin-right: 1rem;
            user-select: none;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        thead {
            background: #667eea;
            color: white;
        }
        
        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        
        tbody tr:hover {
            background: #f9fafb;
        }
        
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge-critical { background: #fee2e2; color: #991b1b; }
        .badge-major { background: #fef9c3; color: #854d0e; }
        .badge-minor { background: #dbeafe; color: #1e40af; }
        .badge-A { background: #dcfce7; color: #166534; }
        .badge-B { background: #dbeafe; color: #1e40af; }
        .badge-C { background: #fef9c3; color: #854d0e; }
        .badge-D { background: #fee2e2; color: #991b1b; }
        .badge-F { background: #fce7f3; color: #9f1239; }
        
        .quick-action-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin: 1.5rem 0;
        }
        
        .quick-action-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            display: inline-block;
        }
        
        .quick-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .stat-box {
            background: #f9fafb;
            padding: 1rem;
            border-radius: 6px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: #666;
            margin-top: 0.25rem;
        }
        
        .recommendation {
            background: #f0fdf4;
            border-left: 4px solid #22c55e;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }
        
        .recommendation-title {
            font-weight: bold;
            color: #166534;
            margin-bottom: 0.5rem;
        }
        
        .footer {
            background: #f9fafb;
            padding: 2rem;
            text-align: center;
            color: #666;
            font-size: 0.9rem;
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e5e7eb;
            border-radius: 15px;
            overflow: hidden;
            margin: 1rem 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #22c55e 0%, #84cc16 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.85rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <span>📊</span>
                <span>Code Quality Analysis Report</span>
            </h1>
            <div class="subtitle">Comprehensive Static Analysis for tkr-docusearch</div>
            <div class="meta">
                Generated: 2025-10-16 | Python 3.13.3 | 70 Files Analyzed
            </div>
        </div>
        
        <div class="content">
            <!-- Executive Summary -->
            <section class="section">
                <div class="executive-summary">
                    <h2>Executive Summary</h2>
                    <div class="score-card">
                        <div class="score-item">
                            <div class="label">Overall Quality Score</div>
                            <div class="value score-good">73/100</div>
                            <div class="description">Good - Maintainable</div>
                        </div>
                        <div class="score-item">
                            <div class="label">Files Analyzed</div>
                            <div class="value">70</div>
                            <div class="description">Python modules</div>
                        </div>
                        <div class="score-item">
                            <div class="label">Total LOC</div>
                            <div class="value">24,306</div>
                            <div class="description">Lines of code</div>
                        </div>
                        <div class="score-item">
                            <div class="label">Avg Maintainability</div>
                            <div class="value score-good">63.2</div>
                            <div class="description">Rank A (Good)</div>
                        </div>
                    </div>
                    
                    <h3>Severity Breakdown</h3>
                    <div class="score-card">
                        <div class="score-item">
                            <div class="label">Critical Issues</div>
                            <div class="value score-critical">3</div>
                            <div class="description">Complexity F (57)</div>
                        </div>
                        <div class="score-item">
                            <div class="label">Major Issues</div>
                            <div class="value score-poor">27</div>
                            <div class="description">Complexity C-D</div>
                        </div>
                        <div class="score-item">
                            <div class="label">Minor Issues</div>
                            <div class="value score-moderate">247</div>
                            <div class="description">PEP 8, unused imports</div>
                        </div>
                        <div class="score-item">
                            <div class="label">TODOs/FIXMEs</div>
                            <div class="value">8</div>
                            <div class="description">Technical debt markers</div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Quick Actions -->
            <section class="section">
                <h2>Quick Actions</h2>
                <div class="quick-action-buttons">
                    <a href="#complexity" class="quick-action-btn">🔧 View Complexity Hotspots</a>
                    <a href="#pep8" class="quick-action-btn">📋 PEP 8 Violations</a>
                    <a href="#smells" class="quick-action-btn">🔍 Code Smells</a>
                    <a href="#recommendations" class="quick-action-btn">💡 Recommendations</a>
                </div>
            </section>
            
            <!-- Complexity Hotspots -->
            <section class="section" id="complexity">
                <h2>1. Cyclomatic Complexity Hotspots</h2>
                <p>Functions with cyclomatic complexity above threshold (CC > 10). High complexity indicates difficult to test and maintain code.</p>
                
                <div class="finding severity-critical">
                    <div class="finding-header">
                        <div class="finding-title">CRITICAL: DoclingParser._parse_with_docling</div>
                        <div class="finding-location">src/processing/docling_parser.py:460</div>
                    </div>
                    <div class="finding-details">
                        <strong>Complexity: 57 (Rank F)</strong> - Extremely high complexity. Function has 57 decision points making it very difficult to test and maintain.
                    </div>
                    <div class="recommendation">
                        <div class="recommendation-title">Refactoring Recommendation:</div>
                        Extract parsing logic into separate methods: _parse_pdf(), _parse_docx(), _parse_pptx(), _handle_asr_options(). Apply Strategy pattern for document type handling.
                    </div>
                </div>
                
                <div class="finding severity-critical">
                    <div class="finding-header">
                        <div class="finding-title">CRITICAL: DocumentProcessor._store_embeddings</div>
                        <div class="finding-location">src/processing/processor.py:483</div>
                    </div>
                    <div class="finding-details">
                        <strong>Complexity: 29 (Rank D)</strong> - Very high complexity with multiple nested conditionals and error handling paths.
                    </div>
                    <div class="recommendation">
                        <div class="recommendation-title">Refactoring Recommendation:</div>
                        Extract embedding storage logic into separate handler classes: VisualEmbeddingHandler, TextEmbeddingHandler. Use early returns to reduce nesting.
                    </div>
                </div>
                
                <div class="finding severity-critical">
                    <div class="finding-header">
                        <div class="finding-title">CRITICAL: docling_to_pages</div>
                        <div class="finding-location">src/processing/docling_parser.py:121</div>
                    </div>
                    <div class="finding-details">
                        <strong>Complexity: 29 (Rank D)</strong> - Complex page conversion logic with multiple transformation steps.
                    </div>
                    <div class="recommendation">
                        <div class="recommendation-title">Refactoring Recommendation:</div>
                        Break into smaller functions: _extract_page_metadata(), _process_page_images(), _build_page_object(). Consider builder pattern for Page construction.
                    </div>
                </div>
                
                <h3>High Complexity Functions (C-D Rank)</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Function</th>
                            <th>File</th>
                            <th>Line</th>
                            <th>Complexity</th>
                            <th>Rank</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>get_document</td>
                            <td>documents_api.py</td>
                            <td>363</td>
                            <td>28</td>
                            <td><span class="badge badge-D">D</span></td>
                        </tr>
                        <tr>
                            <td>DocumentProcessor.process_document</td>
                            <td>processor.py</td>
                            <td>129</td>
                            <td>27</td>
                            <td><span class="badge badge-D">D</span></td>
                        </tr>
                        <tr>
                            <td>verify_output_shapes</td>
                            <td>verify_implementation.py</td>
                            <td>95</td>
                            <td>23</td>
                            <td><span class="badge badge-D">D</span></td>
                        </tr>
                        <tr>
                            <td>validate_embedding_interface</td>
                            <td>validate_mocks.py</td>
                            <td>29</td>
                            <td>22</td>
                            <td><span class="badge badge-D">D</span></td>
                        </tr>
                        <tr>
                            <td>AudioMetadata (class)</td>
                            <td>audio_metadata.py</td>
                            <td>27</td>
                            <td>21</td>
                            <td><span class="badge badge-D">D</span></td>
                        </tr>
                        <tr>
                            <td>AudioMetadata.to_chromadb_metadata</td>
                            <td>audio_metadata.py</td>
                            <td>56</td>
                            <td>20</td>
                            <td><span class="badge badge-C">C</span></td>
                        </tr>
                        <tr>
                            <td>_extract_tables</td>
                            <td>structure_extractor.py</td>
                            <td>160</td>
                            <td>20</td>
                            <td><span class="badge badge-C">C</span></td>
                        </tr>
                        <tr>
                            <td>_extract_pictures</td>
                            <td>structure_extractor.py</td>
                            <td>229</td>
                            <td>18</td>
                            <td><span class="badge badge-C">C</span></td>
                        </tr>
                        <tr>
                            <td>SmartChunker._extract_chunk_context</td>
                            <td>smart_chunker.py</td>
                            <td>133</td>
                            <td>17</td>
                            <td><span class="badge badge-C">C</span></td>
                        </tr>
                        <tr>
                            <td>_extract_code_blocks</td>
                            <td>structure_extractor.py</td>
                            <td>291</td>
                            <td>17</td>
                            <td><span class="badge badge-C">C</span></td>
                        </tr>
                    </tbody>
                </table>
            </section>
            
            <!-- File Quality -->
            <section class="section">
                <h2>2. File Length and Maintainability</h2>
                <p>Large files (>500 LOC) may indicate Single Responsibility Principle violations.</p>
                
                <h3>Largest Files (Potential for Splitting)</h3>
                <table>
                    <thead>
                        <tr>
                            <th>File</th>
                            <th>LOC</th>
                            <th>Maintainability Index</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>docling_parser.py</td>
                            <td>1,017</td>
                            <td class="score-moderate">29.4 (A)</td>
                            <td><span class="badge badge-major">Review</span></td>
                        </tr>
                        <tr>
                            <td>documents_api.py</td>
                            <td>981</td>
                            <td class="score-poor">34.9 (A)</td>
                            <td><span class="badge badge-major">Review</span></td>
                        </tr>
                        <tr>
                            <td>chroma_client.py</td>
                            <td>912</td>
                            <td class="score-moderate">41.0 (A)</td>
                            <td><span class="badge badge-major">Review</span></td>
                        </tr>
                        <tr>
                            <td>test_storage.py</td>
                            <td>872</td>
                            <td class="score-poor">28.2 (A)</td>
                            <td><span class="badge badge-minor">Test</span></td>
                        </tr>
                        <tr>
                            <td>worker_webhook.py</td>
                            <td>746</td>
                            <td class="score-moderate">45.2 (A)</td>
                            <td><span class="badge badge-major">Review</span></td>
                        </tr>
                        <tr>
                            <td>processor.py</td>
                            <td>741</td>
                            <td class="score-moderate">41.4 (A)</td>
                            <td><span class="badge badge-major">Review</span></td>
                        </tr>
                        <tr>
                            <td>test_processing.py</td>
                            <td>654</td>
                            <td class="score-poor">24.4 (A)</td>
                            <td><span class="badge badge-minor">Test</span></td>
                        </tr>
                        <tr>
                            <td>test_search.py</td>
                            <td>578</td>
                            <td class="score-poor">26.4 (A)</td>
                            <td><span class="badge badge-minor">Test</span></td>
                        </tr>
                        <tr>
                            <td>processing_config.py</td>
                            <td>545</td>
                            <td class="score-good">53.7 (A)</td>
                            <td><span class="badge badge-A">OK</span></td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="recommendation">
                    <div class="recommendation-title">Refactoring Recommendation:</div>
                    Files over 500 LOC should be evaluated for splitting. Consider:
                    <ul style="margin-top: 0.5rem;">
                        <li><strong>docling_parser.py</strong>: Extract document type handlers into separate modules (pdf_handler.py, docx_handler.py, pptx_handler.py)</li>
                        <li><strong>documents_api.py</strong>: Split into separate routers for list/get/delete operations</li>
                        <li><strong>chroma_client.py</strong>: Extract collection operations and query builders into separate classes</li>
                        <li><strong>worker_webhook.py</strong>: Separate webhook handlers from processing logic</li>
                    </ul>
                </div>
            </section>
            
            <!-- PEP 8 Compliance -->
            <section class="section" id="pep8">
                <h2>3. PEP 8 Compliance Analysis</h2>
                <p>Total violations: 247 across 70 files. Below are the most common issues.</p>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value">104</div>
                        <div class="stat-label">Unused Imports (F401)</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">60</div>
                        <div class="stat-label">Line Too Long (E501)</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">33</div>
                        <div class="stat-label">Missing f-string (F541)</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">27</div>
                        <div class="stat-label">Import Not at Top (E402)</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">10</div>
                        <div class="stat-label">Unused Variables (F841)</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">5</div>
                        <div class="stat-label">Redefinition (F811)</div>
                    </div>
                </div>
                
                <h3>Top Violation: Unused Imports (F401)</h3>
                <div class="finding severity-minor">
                    <div class="finding-details">
                        <strong>104 occurrences</strong> - Imported modules/functions not used in code. These clutter the namespace and can hide actual dependencies.
                    </div>
                    <div class="code-block">
<span class="line-number">15:</span> from typing.Tuple imported but unused
<span class="line-number">19:</span> 'time' imported but unused  
<span class="line-number">20:</span> 'typing.Dict' imported but unused
<span class="line-number">20:</span> 'typing.Any' imported but unused
                    </div>
                    <div class="recommendation">
                        <div class="recommendation-title">Fix Strategy:</div>
                        Run automated cleanup: <code>autoflake --remove-all-unused-imports --in-place src/**/*.py</code>
                    </div>
                </div>
                
                <h3>Second: Line Too Long (E501)</h3>
                <div class="finding severity-minor">
                    <div class="finding-details">
                        <strong>60 occurrences</strong> - Lines exceeding 100 characters. Impacts readability on smaller screens.
                    </div>
                    <div class="code-block">
<span class="line-number">358:</span> E501 line too long (131 > 100 characters)  # chroma_client.py
<span class="line-number">153:</span> E501 line too long (128 > 100 characters)  # result_ranker.py
<span class="line-number">372:</span> E501 line too long (111 > 100 characters)  # mocks.py
                    </div>
                    <div class="recommendation">
                        <div class="recommendation-title">Fix Strategy:</div>
                        Use Black formatter with --line-length 100 or break long lines using parentheses and backslashes.
                    </div>
                </div>
                
                <h3>Critical: Bare Except (E722)</h3>
                <div class="finding severity-major">
                    <div class="finding-header">
                        <div class="finding-title">Bare except clause</div>
                        <div class="finding-location">src/embeddings/model_loader.py:366</div>
                    </div>
                    <div class="finding-details">
                        <strong>1 occurrence</strong> - Catches all exceptions including SystemExit and KeyboardInterrupt. Dangerous anti-pattern.
                    </div>
                    <div class="code-block">
<span class="line-number">366:</span> except:
<span class="line-number">367:</span>     # Silently fails - DANGEROUS!
                    </div>
                    <div class="recommendation">
                        <div class="recommendation-title">Fix Strategy:</div>
                        Replace with specific exception: <code>except Exception as e:</code> or better yet, catch only expected exceptions like <code>except (ImportError, RuntimeError) as e:</code>
                    </div>
                </div>
            </section>
            
            <!-- Code Smells -->
            <section class="section" id="smells">
                <h2>4. Code Smells and Anti-Patterns</h2>
                
                <h3>Long Parameter Lists</h3>
                <p>No functions found with excessive parameters (>6). Good adherence to clean code principles.</p>
                
                <h3>TODO/FIXME Comments</h3>
                <div class="finding severity-minor">
                    <div class="finding-details">
                        <strong>8 TODO comments found</strong> - Technical debt markers indicating incomplete features or deferred work.
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>File</th>
                                <th>Line</th>
                                <th>Comment</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>test_audio_album_art.py</td>
                                <td>276</td>
                                <td>TODO: Implement once full processing pipeline is integrated</td>
                            </tr>
                            <tr>
                                <td>test_audio_album_art.py</td>
                                <td>290</td>
                                <td>TODO: Implement once full processing pipeline is integrated</td>
                            </tr>
                            <tr>
                                <td>test_audio_album_art.py</td>
                                <td>303</td>
                                <td>TODO: Implement once full processing pipeline is integrated</td>
                            </tr>
                            <tr>
                                <td>test_audio_album_art.py</td>
                                <td>316</td>
                                <td>TODO: Implement once full processing pipeline is integrated</td>
                            </tr>
                            <tr>
                                <td>test_audio_album_art.py</td>
                                <td>329</td>
                                <td>TODO: Implement once full processing pipeline is integrated</td>
                            </tr>
                            <tr>
                                <td>test_audio_album_art.py</td>
                                <td>354</td>
                                <td>TODO: Implement once production environment is ready</td>
                            </tr>
                            <tr>
                                <td>smart_chunker.py</td>
                                <td>46</td>
                                <td>TODO: Could be made configurable to match text embedding model</td>
                            </tr>
                            <tr>
                                <td>server.py</td>
                                <td>440</td>
                                <td>TODO: Implement actual status tracking</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="recommendation">
                        <div class="recommendation-title">Recommendation:</div>
                        Convert TODOs into GitHub issues with proper tracking. Remove or implement the deferred work.
                    </div>
                </div>
                
                <h3>Duplicate Code Detection</h3>
                <p>Manual inspection suggests potential duplication in:</p>
                <ul style="margin-left: 2rem; margin-top: 0.5rem;">
                    <li><strong>Test files</strong>: Common setup patterns in test_storage.py, test_processing.py, test_search.py could be extracted to conftest.py fixtures</li>
                    <li><strong>API handlers</strong>: Error handling patterns repeated across documents_api.py endpoints</li>
                    <li><strong>Metadata extraction</strong>: Similar patterns in audio_metadata.py and structure_extractor.py</li>
                </ul>
                
                <h3>Import Organization</h3>
                <div class="finding severity-minor">
                    <div class="finding-details">
                        <strong>27 occurrences of E402</strong> - Module level imports not at top of file. Violates PEP 8 and can cause subtle bugs.
                    </div>
                    <div class="recommendation">
                        <div class="recommendation-title">Fix Strategy:</div>
                        Use isort to automatically organize imports: <code>isort src/</code>
                    </div>
                </div>
            </section>
            
            <!-- Function Quality -->
            <section class="section">
                <h2>5. Function Quality Metrics</h2>
                
                <h3>Functions Exceeding Length Guidelines</h3>
                <p>Functions over 50 lines may violate Single Responsibility Principle.</p>
                
                <table>
                    <thead>
                        <tr>
                            <th>Function</th>
                            <th>File</th>
                            <th>SLOC</th>
                            <th>Complexity</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>DoclingParser._parse_with_docling</td>
                            <td>docling_parser.py</td>
                            <td>~200</td>
                            <td>57</td>
                            <td><span class="badge badge-critical">Refactor</span></td>
                        </tr>
                        <tr>
                            <td>get_document</td>
                            <td>documents_api.py</td>
                            <td>~120</td>
                            <td>28</td>
                            <td><span class="badge badge-critical">Refactor</span></td>
                        </tr>
                        <tr>
                            <td>DocumentProcessor.process_document</td>
                            <td>processor.py</td>
                            <td>~150</td>
                            <td>27</td>
                            <td><span class="badge badge-critical">Refactor</span></td>
                        </tr>
                        <tr>
                            <td>search_documents</td>
                            <td>server.py</td>
                            <td>~55</td>
                            <td>8</td>
                            <td><span class="badge badge-A">OK</span></td>
                        </tr>
                    </tbody>
                </table>
            </section>
            
            <!-- Maintainability Index -->
            <section class="section">
                <h2>6. Maintainability Index Distribution</h2>
                <p>Maintainability Index ranges from 0 (unmaintainable) to 100 (perfectly maintainable). All files scored Rank A.</p>
                
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 73%">73% Average MI - GOOD</div>
                </div>
                
                <h3>Files Needing Attention (MI < 40)</h3>
                <table>
                    <thead>
                        <tr>
                            <th>File</th>
                            <th>MI Score</th>
                            <th>Rank</th>
                            <th>Primary Issues</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>test_file_validator.py</td>
                            <td>24.2</td>
                            <td><span class="badge badge-A">A</span></td>
                            <td>Test file - acceptable</td>
                        </tr>
                        <tr>
                            <td>test_processing.py</td>
                            <td>24.4</td>
                            <td><span class="badge badge-A">A</span></td>
                            <td>Test file - acceptable</td>
                        </tr>
                        <tr>
                            <td>test_search.py</td>
                            <td>26.4</td>
                            <td><span class="badge badge-A">A</span></td>
                            <td>Test file - acceptable</td>
                        </tr>
                        <tr>
                            <td>test_storage.py</td>
                            <td>28.2</td>
                            <td><span class="badge badge-A">A</span></td>
                            <td>Test file - acceptable</td>
                        </tr>
                        <tr>
                            <td>docling_parser.py</td>
                            <td>29.4</td>
                            <td><span class="badge badge-A">A</span></td>
                            <td>High complexity (F57), long file</td>
                        </tr>
                        <tr>
                            <td>test_asr_config.py</td>
                            <td>29.7</td>
                            <td><span class="badge badge-A">A</span></td>
                            <td>Test file - acceptable</td>
                        </tr>
                        <tr>
                            <td>test_status_api.py</td>
                            <td>33.8</td>
                            <td><span class="badge badge-A">A</span></td>
                            <td>Test file - acceptable</td>
                        </tr>
                        <tr>
                            <td>test_status_manager.py</td>
                            <td>33.8</td>
                            <td><span class="badge badge-A">A</span></td>
                            <td>Test file - acceptable</td>
                        </tr>
                        <tr>
                            <td>documents_api.py</td>
                            <td>34.9</td>
                            <td><span class="badge badge-A">A</span></td>
                            <td>High complexity (D28), long file</td>
                        </tr>
                        <tr>
                            <td>test_timestamp_extraction.py</td>
                            <td>36.0</td>
                            <td><span class="badge badge-A">A</span></td>
                            <td>Test file - acceptable</td>
                        </tr>
                        <tr>
                            <td>verify_implementation.py</td>
                            <td>37.5</td>
                            <td><span class="badge badge-A">A</span></td>
                            <td>High complexity (D23)</td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="recommendation">
                    <div class="recommendation-title">Note on Test Files:</div>
                    Lower MI scores in test files are acceptable as tests often have repetitive setup code and many assertions. Focus refactoring efforts on production code: docling_parser.py, documents_api.py, verify_implementation.py.
                </div>
            </section>
            
            <!-- Type Safety -->
            <section class="section">
                <h2>7. Type Safety and Type Hints</h2>
                <p>Python type hints (PEP 484) improve code documentation and enable static type checking.</p>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value score-good">High</div>
                        <div class="stat-label">Type Hint Coverage</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">0</div>
                        <div class="stat-label">Explicit 'any' Usage</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value score-excellent">Good</div>
                        <div class="stat-label">Pydantic Models</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">0</div>
                        <div class="stat-label">Unsafe Type Casts</div>
                    </div>
                </div>
                
                <div class="recommendation">
                    <div class="recommendation-title">Recommendation:</div>
                    Codebase demonstrates excellent type safety practices with extensive use of Pydantic models and dataclasses. No 'any' types or unsafe casts detected. Consider running mypy for comprehensive type checking: <code>mypy src/ --strict</code>
                </div>
            </section>
            
            <!-- Recommendations -->
            <section class="section" id="recommendations">
                <h2>8. Prioritized Refactoring Recommendations</h2>
                
                <h3>High Priority (Critical Impact)</h3>
                <div class="finding severity-critical">
                    <div class="finding-title">1. Refactor DoclingParser._parse_with_docling (CC: 57)</div>
                    <div class="finding-details">
                        <strong>Impact:</strong> Extremely high complexity makes testing nearly impossible and maintenance error-prone.<br>
                        <strong>Effort:</strong> Large (2-3 days)<br>
                        <strong>Strategy:</strong>
                        <ul style="margin-top: 0.5rem; margin-left: 1.5rem;">
                            <li>Extract document type handlers: PdfParseStrategy, DocxParseStrategy, PptxParseStrategy</li>
                            <li>Create AsrOptionsBuilder for ASR configuration</li>
                            <li>Apply Strategy pattern with factory for document type selection</li>
                            <li>Target complexity: < 10 per method</li>
                        </ul>
                    </div>
                </div>
                
                <div class="finding severity-critical">
                    <div class="finding-title">2. Refactor DocumentProcessor._store_embeddings (CC: 29)</div>
                    <div class="finding-details">
                        <strong>Impact:</strong> Core processing logic with high risk of bugs due to complexity.<br>
                        <strong>Effort:</strong> Medium (1-2 days)<br>
                        <strong>Strategy:</strong>
                        <ul style="margin-top: 0.5rem; margin-left: 1.5rem;">
                            <li>Extract VisualEmbeddingHandler and TextEmbeddingHandler classes</li>
                            <li>Use early returns to reduce nesting depth</li>
                            <li>Apply Command pattern for different embedding types</li>
                            <li>Add comprehensive unit tests for each handler</li>
                        </ul>
                    </div>
                </div>
                
                <div class="finding severity-critical">
                    <div class="finding-title">3. Fix Bare Except in model_loader.py:366</div>
                    <div class="finding-details">
                        <strong>Impact:</strong> Dangerous - can mask critical errors including KeyboardInterrupt.<br>
                        <strong>Effort:</strong> Small (30 minutes)<br>
                        <strong>Strategy:</strong>
                        Replace <code>except:</code> with specific exception handling or at minimum <code>except Exception as e:</code> with proper logging.
                    </div>
                </div>
                
                <h3>Medium Priority (Quality Improvement)</h3>
                <div class="finding severity-major">
                    <div class="finding-title">4. Split Large Files (>500 LOC)</div>
                    <div class="finding-details">
                        <strong>Impact:</strong> Improves code organization and reduces cognitive load.<br>
                        <strong>Effort:</strong> Medium-Large (varies by file)<br>
                        <strong>Files:</strong> docling_parser.py (1017), documents_api.py (981), chroma_client.py (912), worker_webhook.py (746), processor.py (741)
                    </div>
                </div>
                
                <div class="finding severity-major">
                    <div class="finding-title">5. Remove Unused Imports (104 occurrences)</div>
                    <div class="finding-details">
                        <strong>Impact:</strong> Improves code clarity and reduces namespace pollution.<br>
                        <strong>Effort:</strong> Small (1 hour automated)<br>
                        <strong>Command:</strong> <code>autoflake --remove-all-unused-imports --in-place --recursive src/</code>
                    </div>
                </div>
                
                <h3>Low Priority (Code Polish)</h3>
                <div class="finding severity-minor">
                    <div class="finding-title">6. Fix Line Length Violations (60 occurrences)</div>
                    <div class="finding-details">
                        <strong>Impact:</strong> Improves readability on various screen sizes.<br>
                        <strong>Effort:</strong> Small (1 hour automated)<br>
                        <strong>Command:</strong> <code>black src/ --line-length 100</code>
                    </div>
                </div>
                
                <div class="finding severity-minor">
                    <div class="finding-title">7. Convert TODOs to Issues (8 items)</div>
                    <div class="finding-details">
                        <strong>Impact:</strong> Better tracking of technical debt.<br>
                        <strong>Effort:</strong> Small (1 hour)<br>
                        <strong>Strategy:</strong> Create GitHub issues for each TODO and reference issue number in code comments.
                    </div>
                </div>
                
                <div class="finding severity-minor">
                    <div class="finding-title">8. Organize Imports with isort (27 E402 violations)</div>
                    <div class="finding-details">
                        <strong>Impact:</strong> Standardizes import organization across codebase.<br>
                        <strong>Effort:</strong> Small (30 minutes)<br>
                        <strong>Command:</strong> <code>isort src/</code>
                    </div>
                </div>
            </section>
            
            <!-- Summary -->
            <section class="section">
                <h2>9. Summary and Next Steps</h2>
                
                <div class="executive-summary">
                    <h3>Overall Assessment</h3>
                    <p><strong>Quality Score: 73/100 (Good - Maintainable)</strong></p>
                    <p>The tkr-docusearch codebase demonstrates generally good code quality with strong type safety practices and comprehensive test coverage. However, there are critical complexity hotspots that require immediate attention.</p>
                    
                    <h3>Strengths</h3>
                    <ul style="margin-left: 2rem; margin-top: 0.5rem;">
                        <li>Excellent type safety with extensive use of Pydantic models and type hints</li>
                        <li>Comprehensive test coverage (test files account for significant LOC)</li>
                        <li>Good use of dataclasses and modern Python patterns</li>
                        <li>All files maintain Rank A maintainability index</li>
                        <li>No wildcard imports or unsafe type casts detected</li>
                    </ul>
                    
                    <h3>Critical Areas for Improvement</h3>
                    <ul style="margin-left: 2rem; margin-top: 0.5rem;">
                        <li><strong>Complexity Hotspots:</strong> 3 functions with critical complexity (F57, D29, D29)</li>
                        <li><strong>Large Files:</strong> 5 files exceed 700 LOC, violating Single Responsibility</li>
                        <li><strong>Code Hygiene:</strong> 104 unused imports and 60 line length violations</li>
                        <li><strong>Technical Debt:</strong> 8 TODO comments indicate deferred work</li>
                    </ul>
                    
                    <h3>Recommended Action Plan</h3>
                    <ol style="margin-left: 2rem; margin-top: 0.5rem; line-height: 1.8;">
                        <li><strong>Week 1:</strong> Refactor DoclingParser._parse_with_docling (highest risk)</li>
                        <li><strong>Week 2:</strong> Refactor DocumentProcessor methods (high complexity)</li>
                        <li><strong>Week 3:</strong> Split large files (docling_parser.py, documents_api.py)</li>
                        <li><strong>Week 4:</strong> Code hygiene - automated fixes (imports, formatting)</li>
                        <li><strong>Ongoing:</strong> Implement pre-commit hooks for flake8, black, isort</li>
                    </ol>
                    
                    <h3>Automation Recommendations</h3>
                    <div class="code-block" style="margin-top: 1rem;">
# Add to .pre-commit-config.yaml
repos:
  - repo: https://github.com/PyCQA/flake8
    hooks:
      - id: flake8
        args: [--max-line-length=100]
  
  - repo: https://github.com/psf/black
    hooks:
      - id: black
        args: [--line-length=100]
  
  - repo: https://github.com/PyCQA/isort
    hooks:
      - id: isort
        args: [--profile=black]
  
  - repo: https://github.com/PyCQA/pylint
    hooks:
      - id: pylint
        args: [--max-complexity=10]
                    </div>
                </div>
            </section>
        </div>
        
        <div class="footer">
            <p>Generated by Code Quality Agent (tkr-context-kit v3.6.0)</p>
            <p>Analysis Date: 2025-10-16 | Python 3.13.3 | 70 Files | 24,306 LOC</p>
            <p>Tools: radon, flake8, custom pattern analysis</p>
        </div>
    </div>
    
    <script>
        // Add any interactive functionality here
        console.log('Code Quality Report Loaded');
        
        // Highlight sections on hover
        document.querySelectorAll('.finding').forEach(el => {
            el.addEventListener('mouseenter', () => {
                el.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
            });
            el.addEventListener('mouseleave', () => {
                el.style.boxShadow = 'none';
            });
        });
    </script>
</body>
</html>
